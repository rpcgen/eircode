package com.fexco.alliesComputing

import org.springframework.http.HttpStatus
import org.springframework.http.ResponseEntity
import org.springframework.web.client.RestTemplate
import spock.lang.Specification
import spock.lang.Unroll

class AddressClientSpec extends Specification {

    private static final String IE_EXPECTED_RESPONSE = '[{"addressline1":"Department of Communications, Climate Action and Environment","addressline2":"29-31 Adelaide Road","summaryline":"Department of Communications, Climate Action and Environment, 29-31 Adelaide Road, Dublin 2, D02 X285","organisation":"Department of Communications, Climate Action and Environment","number":"29-31","premise":"29-31","street":"Adelaide Road","posttown":"Dublin 2","county":"Dublin","postcode":"D02 X285"}]'
    private static final String UK_EXPECTED_RESPONSE = '[{"addressline1":"Allies Computing Ltd","addressline2":"Manor Farm Barns, Fox Road","addressline3":"Framingham Pigot","summaryline":"Allies Computing Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Allies Computing Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"B 2 B Cashflow Solutions Ltd","addressline2":"Manor Farm Barns, Fox Road","addressline3":"Framingham Pigot","summaryline":"B 2 B Cashflow Solutions Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"B 2 B Cashflow Solutions Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Brasteds Event Excellence","addressline2":"Manor Farm Barns, Fox Road","addressline3":"Framingham Pigot","summaryline":"Brasteds Event Excellence, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Brasteds Event Excellence","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Brasteds Lodge","addressline2":"Manor Farm Barns, Fox Road","addressline3":"Framingham Pigot","summaryline":"Brasteds Lodge, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Brasteds Lodge","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Conker Interiors Ltd","addressline2":"Manor Farm Barns, Fox Road","addressline3":"Framingham Pigot","summaryline":"Conker Interiors Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Conker Interiors Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Eastern Chauffeurs Ltd","addressline2":"Manor Farm Barns, Fox Road","addressline3":"Framingham Pigot","summaryline":"Eastern Chauffeurs Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Eastern Chauffeurs Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Equal Lives","addressline2":"Manor Farm Barns, Fox Road","addressline3":"Framingham Pigot","summaryline":"Equal Lives, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Equal Lives","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Estate Office","addressline2":"Manor Farm Barns, Fox Road","addressline3":"Framingham Pigot","summaryline":"Estate Office, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Estate Office","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Framingham Pigot Parish Meeting","addressline2":"Manor Farm Barns, Fox Road","addressline3":"Framingham Pigot","summaryline":"Framingham Pigot Parish Meeting, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Framingham Pigot Parish Meeting","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Genesis Lifts Ltd","addressline2":"Manor Farm Barns, Fox Road","addressline3":"Framingham Pigot","summaryline":"Genesis Lifts Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Genesis Lifts Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Mancroft International","addressline2":"Manor Farm Barns, Fox Road","addressline3":"Framingham Pigot","summaryline":"Mancroft International, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Mancroft International","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Paradox, Manor Farm Barns","addressline2":"Fox Road","addressline3":"Framingham Pigot","summaryline":"Paradox, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Paradox","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Serenity Training Ltd","addressline2":"Manor Farm Barns, Fox Road","addressline3":"Framingham Pigot","summaryline":"Serenity Training Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Serenity Training Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Variblast Ltd","addressline2":"Manor Farm Barns, Fox Road","addressline3":"Framingham Pigot","summaryline":"Variblast Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Variblast Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"(Potter)","addressline2":"Fox Road","addressline3":"Framingham Pigot","summaryline":"(Potter), Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"(Potter)","premise":"(Potter)","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Beck Cottage","addressline2":"Fox Road","addressline3":"Framingham Pigot","summaryline":"Beck Cottage, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Beck Cottage","premise":"Beck Cottage","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Burnside","addressline2":"Fox Road","addressline3":"Framingham Pigot","summaryline":"Burnside, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Burnside","premise":"Burnside","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Charles Cottage","addressline2":"Fox Road","addressline3":"Framingham Pigot","summaryline":"Charles Cottage, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Charles Cottage","premise":"Charles Cottage","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Cottage-On-The-Beck","addressline2":"Fox Road","addressline3":"Framingham Pigot","summaryline":"Cottage-On-The-Beck, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Cottage-On-The-Beck","premise":"Cottage-On-The-Beck","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Foxes Cottage","addressline2":"Fox Road","addressline3":"Framingham Pigot","summaryline":"Foxes Cottage, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Foxes Cottage","premise":"Foxes Cottage","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Framingham Cottage","addressline2":"Fox Road","addressline3":"Framingham Pigot","summaryline":"Framingham Cottage, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Framingham Cottage","premise":"Framingham Cottage","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Manor Farm Barns","addressline2":"Fox Road","addressline3":"Framingham Pigot","summaryline":"Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"Old Manor Farm","addressline2":"Fox Road","addressline3":"Framingham Pigot","summaryline":"Old Manor Farm, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Old Manor Farm","premise":"Old Manor Farm","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"1 Penns Cottages","addressline2":"Fox Road","addressline3":"Framingham Pigot","summaryline":"1 Penns Cottages, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"1 Penns Cottages","premise":"1 Penns Cottages","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"2 Penns Cottages","addressline2":"Fox Road","addressline3":"Framingham Pigot","summaryline":"2 Penns Cottages, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"2 Penns Cottages","premise":"2 Penns Cottages","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"The Grange","addressline2":"Fox Road","addressline3":"Framingham Pigot","summaryline":"The Grange, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"The Grange","premise":"The Grange","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"1 Fox Road","addressline2":"Framingham Pigot","summaryline":"1 Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","number":"1","premise":"1","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"addressline1":"2 Fox Road","addressline2":"Framingham Pigot","summaryline":"2 Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","number":"2","premise":"2","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"}]'

    @Unroll
    void "test address client against the example request (#country)"() {

        given:
        AddressClient addressClient = new AddressClient()
        addressClient.scheme = 'http'
        addressClient.host   = 'ws.postcoder.com'
        addressClient.apiKey = 'PCW45-12345-12345-1234X'
        addressClient.restTemplate = new RestTemplate()

        when:
        ResponseEntity<String> response = addressClient.forwardRequestToAlliesComputing(country, 'D02X285',
                [
                        'lines'  : ['3']    as String[],
                        'format' : ['json'] as String[]
                ])

        then:
        response.statusCode == HttpStatus.OK
        response.body == expected_response

        where:
        country | expected_response
        'ie'    | IE_EXPECTED_RESPONSE
        'uk'    | UK_EXPECTED_RESPONSE
    }
}
