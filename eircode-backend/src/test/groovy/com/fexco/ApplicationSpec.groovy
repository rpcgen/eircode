package com.fexco

import com.fexco.alliesComputing.AddressClient
import org.springframework.beans.factory.annotation.Autowired
import org.springframework.beans.factory.annotation.Value
import org.springframework.boot.test.context.SpringBootTest
import org.springframework.web.client.RestTemplate
import spock.lang.Specification
import spock.lang.Unroll

@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)
class ApplicationSpec extends Specification {

    private static final String IE_EXPECTED_RESPONSE = '[{"summaryline":"Department of Communications, Climate Action and Environment, 29-31 Adelaide Road, Dublin 2, D02 X285","organisation":"Department of Communications, Climate Action and Environment","number":"29-31","premise":"29-31","street":"Adelaide Road","posttown":"Dublin 2","county":"Dublin","postcode":"D02 X285"}]'
    private static final String UK_EXPECTED_RESPONSE = '[{"summaryline":"Allies Computing Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Allies Computing Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"B 2 B Cashflow Solutions Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"B 2 B Cashflow Solutions Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Brasteds Event Excellence, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Brasteds Event Excellence","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Brasteds Lodge, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Brasteds Lodge","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Conker Interiors Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Conker Interiors Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Eastern Chauffeurs Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Eastern Chauffeurs Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Equal Lives, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Equal Lives","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Estate Office, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Estate Office","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Framingham Pigot Parish Meeting, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Framingham Pigot Parish Meeting","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Genesis Lifts Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Genesis Lifts Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Mancroft International, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Mancroft International","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Paradox, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Paradox","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Serenity Training Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Serenity Training Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Variblast Ltd, Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","organisation":"Variblast Ltd","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"(Potter), Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"(Potter)","premise":"(Potter)","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Beck Cottage, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Beck Cottage","premise":"Beck Cottage","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Burnside, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Burnside","premise":"Burnside","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Charles Cottage, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Charles Cottage","premise":"Charles Cottage","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Cottage-On-The-Beck, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Cottage-On-The-Beck","premise":"Cottage-On-The-Beck","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Foxes Cottage, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Foxes Cottage","premise":"Foxes Cottage","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Framingham Cottage, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Framingham Cottage","premise":"Framingham Cottage","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Manor Farm Barns, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Manor Farm Barns","premise":"Manor Farm Barns","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"Old Manor Farm, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"Old Manor Farm","premise":"Old Manor Farm","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"1 Penns Cottages, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"1 Penns Cottages","premise":"1 Penns Cottages","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"2 Penns Cottages, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"2 Penns Cottages","premise":"2 Penns Cottages","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"The Grange, Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","buildingname":"The Grange","premise":"The Grange","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"1 Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","number":"1","premise":"1","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"},{"summaryline":"2 Fox Road, Framingham Pigot, Norwich, Norfolk, NR14 7PZ","number":"2","premise":"2","street":"Fox Road","dependentlocality":"Framingham Pigot","posttown":"Norwich","county":"Norfolk","postcode":"NR14 7PZ"}]'

    @Autowired
    RestTemplate restTemplate;

    @Value('${local.server.port}')
    int port;

    @Unroll
    void "get-address end point is working properly"() {


        when:
        String response = restTemplate.getForObject("http://localhost:$port/v1/get-address/$country/XXX", String.class)

        then:
        response == expected_response

        where:
        country | expected_response
        'ie'    | IE_EXPECTED_RESPONSE
        'uk'    | UK_EXPECTED_RESPONSE
    }
}
